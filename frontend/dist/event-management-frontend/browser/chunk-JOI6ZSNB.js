import{a as it}from"./chunk-A4UUN2PI.js";import{a as J,c as Q,d as W}from"./chunk-IPLAP3G7.js";import{a as R,b as j,e as K,h as H}from"./chunk-6U4QZZGF.js";import"./chunk-LXGICSYG.js";import{b as O,d as h,f as B,g as T,j as L,l as z,m as D,o as V,q,r as G,t as U,w as A}from"./chunk-NEXUFI76.js";import{A as rt,B as ot,a as X,b as Y,d as Z,e as $,f as tt,g as et,h as nt}from"./chunk-PZ4Z3RAM.js";import{d as k,e as E,g as I,ja as N,p as F}from"./chunk-EGCVCM76.js";import{Aa as l,Ab as M,Db as n,Eb as r,Fb as f,Jb as S,Lb as g,Mb as w,Xb as a,Yb as C,Za as i,Zb as y,ba as u,ja as b,jb as x,ka as v,ob as p,ub as s}from"./chunk-QXQWZ6TV.js";function at(e,d){if(e&1){let o=S();n(0,"mat-form-field",6)(1,"mat-label"),a(2,"Nuvarande l\xF6senord"),r(),f(3,"input",15),n(4,"button",8),g("click",function(){b(o);let t=w();return v(t.showCurrentPassword.set(!t.showCurrentPassword()))}),n(5,"mat-icon"),a(6),r()(),n(7,"mat-error"),a(8,"Nuvarande l\xF6senord kr\xE4vs"),r()()}if(e&2){let o=w();i(3),s("type",o.showCurrentPassword()?"text":"password"),i(3),C(o.showCurrentPassword()?"visibility_off":"visibility")}}function st(e,d){e&1&&(n(0,"mat-error"),a(1," Nytt l\xF6senord kr\xE4vs "),r())}function mt(e,d){e&1&&(n(0,"mat-error"),a(1," L\xF6senordet m\xE5ste vara minst 8 tecken "),r())}function dt(e,d){if(e&1&&(n(0,"div",16)(1,"span",17),a(2,"L\xF6senordsstyrka:"),r(),n(3,"span",18),a(4),r()()),e&2){let o=w();i(3),s("ngClass",o.passwordStrength()),i(),y(" ",o.getStrengthLabel(o.passwordStrength())," ")}}function lt(e,d){e&1&&(n(0,"mat-error"),a(1," Bekr\xE4fta l\xF6senordet "),r())}function pt(e,d){e&1&&(n(0,"div",19)(1,"mat-icon"),a(2,"error"),r(),a(3," L\xF6senorden matchar inte "),r())}function ut(e,d){e&1&&f(0,"mat-spinner",14)}function ct(e,d){e&1&&a(0," Byt l\xF6senord ")}var Dt=(()=>{class e{fb=u(V);router=u(F);authService=u(N);userService=u(it);snackBar=u(rt);form;saving=l(!1);showCurrentPassword=l(!1);showNewPassword=l(!1);showConfirmPassword=l(!1);passwordStrength=l(null);mustChangePassword=l(!1);constructor(){let o=this.authService.getCurrentUser();this.mustChangePassword.set(o?.mustChangePassword??!1),this.form=this.fb.group({currentPassword:[(this.mustChangePassword(),""),this.mustChangePassword()?[]:[h.required]],newPassword:["",[h.required,h.minLength(8)]],confirmPassword:["",h.required]}),this.form.get("newPassword")?.valueChanges.subscribe(m=>{this.passwordStrength.set(this.userService.calculatePasswordStrength(m))})}passwordMismatch(){let o=this.form.get("newPassword")?.value,m=this.form.get("confirmPassword")?.value;return m&&o!==m}getStrengthLabel(o){switch(o){case"svagt":return"Svagt";case"mellan":return"Mellan";case"starkt":return"Starkt";default:return""}}onSubmit(){if(this.form.invalid||this.passwordMismatch())return;this.saving.set(!0);let{currentPassword:o,newPassword:m}=this.form.value;this.authService.changePassword(this.mustChangePassword()?null:o,m).subscribe({next:()=>{this.saving.set(!1),this.snackBar.open("L\xF6senordet har bytts!","OK",{duration:3e3}),this.authService.getCurrentUser()?.role==="SUPERADMIN"?this.router.navigate(["/admin/users"]):this.router.navigate(["/events"])},error:t=>{this.saving.set(!1),this.snackBar.open(t.error?.error||"Kunde inte byta l\xF6senord","St\xE4ng",{duration:5e3,panelClass:"error-snackbar"})}})}static \u0275fac=function(m){return new(m||e)};static \u0275cmp=x({type:e,selectors:[["app-change-password"]],decls:31,vars:13,consts:[[1,"change-password-container"],[1,"change-password-card"],[1,"title"],[1,"subtitle"],[3,"ngSubmit","formGroup"],["appearance","outline","class","full-width",4,"ngIf"],["appearance","outline",1,"full-width"],["matInput","","formControlName","newPassword",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],[4,"ngIf"],["class","strength-indicator",4,"ngIf"],["matInput","","formControlName","confirmPassword",3,"type"],["class","error-message",4,"ngIf"],["mat-flat-button","","type","submit",1,"submit-button",3,"disabled"],["diameter","20"],["matInput","","formControlName","currentPassword",3,"type"],[1,"strength-indicator"],[1,"strength-label"],[1,"strength-badge",3,"ngClass"],[1,"error-message"]],template:function(m,t){if(m&1&&(n(0,"div",0)(1,"mat-card",1)(2,"mat-card-content")(3,"h1",2),a(4,"Byt l\xF6senord"),r(),n(5,"p",3),a(6," Du m\xE5ste byta ditt l\xF6senord innan du kan forts\xE4tta. "),r(),n(7,"form",4),g("ngSubmit",function(){return t.onSubmit()}),p(8,at,9,2,"mat-form-field",5),n(9,"mat-form-field",6)(10,"mat-label"),a(11,"Nytt l\xF6senord"),r(),f(12,"input",7),n(13,"button",8),g("click",function(){return t.showNewPassword.set(!t.showNewPassword())}),n(14,"mat-icon"),a(15),r()(),p(16,st,2,0,"mat-error",9)(17,mt,2,0,"mat-error",9),r(),p(18,dt,5,2,"div",10),n(19,"mat-form-field",6)(20,"mat-label"),a(21,"Bekr\xE4fta nytt l\xF6senord"),r(),f(22,"input",11),n(23,"button",8),g("click",function(){return t.showConfirmPassword.set(!t.showConfirmPassword())}),n(24,"mat-icon"),a(25),r()(),p(26,lt,2,0,"mat-error",9),r(),p(27,pt,4,0,"div",12),n(28,"button",13),p(29,ut,1,0,"mat-spinner",14)(30,ct,1,0),r()()()()()),m&2){let c,_,P;i(7),s("formGroup",t.form),i(),s("ngIf",!t.mustChangePassword()),i(4),s("type",t.showNewPassword()?"text":"password"),i(3),C(t.showNewPassword()?"visibility_off":"visibility"),i(),s("ngIf",(c=t.form.get("newPassword"))==null?null:c.hasError("required")),i(),s("ngIf",(_=t.form.get("newPassword"))==null?null:_.hasError("minlength")),i(),s("ngIf",t.passwordStrength()),i(4),s("type",t.showConfirmPassword()?"text":"password"),i(3),C(t.showConfirmPassword()?"visibility_off":"visibility"),i(),s("ngIf",(P=t.form.get("confirmPassword"))==null?null:P.hasError("required")),i(),s("ngIf",t.passwordMismatch()),i(),s("disabled",t.form.invalid||t.passwordMismatch()||t.saving()),i(),M(t.saving()?29:30)}},dependencies:[I,k,E,q,L,O,B,T,z,D,A,G,U,J,H,R,j,K,W,Q,Z,Y,X,tt,$,nt,et,ot],styles:[".change-password-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;align-items:center;justify-content:center;background-color:#416487;padding:16px}.change-password-card[_ngcontent-%COMP%]{width:100%;max-width:440px;padding:40px;border-radius:16px}.title[_ngcontent-%COMP%]{text-align:center;font-size:22px;font-weight:500;color:#333;margin:0 0 8px}.subtitle[_ngcontent-%COMP%]{text-align:center;font-size:14px;color:#666;margin:0 0 32px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:16px}.strength-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:16px;padding:12px;background:#f5f5f5;border-radius:8px}.strength-label[_ngcontent-%COMP%]{font-size:13px;color:#666}.strength-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:16px;font-size:12px;font-weight:500}.strength-badge.svagt[_ngcontent-%COMP%]{background:#ffebee;color:#c62828}.strength-badge.mellan[_ngcontent-%COMP%]{background:#fff8e1;color:#f57f17}.strength-badge.starkt[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.error-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:12px;background:#ffebee;color:#c62828;border-radius:8px;margin-bottom:16px;font-size:14px}.error-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.submit-button[_ngcontent-%COMP%]{width:100%;height:48px;font-size:16px;background-color:#416487!important;color:#fff!important;border-radius:8px;margin-top:8px}.submit-button[_ngcontent-%COMP%]:disabled{background-color:#ccc!important}[_nghost-%COMP%]     .mat-mdc-form-field-flex{height:56px!important}[_nghost-%COMP%]     .mdc-text-field--outlined{--mdc-outlined-text-field-container-shape: 8px}"]})}return e})();export{Dt as ChangePasswordComponent};
